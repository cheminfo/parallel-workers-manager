<html>
  <head>
    <script src="./parallel-workers-manager.js"></script>
    <script src="./uint8-base64.js"></script>
    <script src="./inflate.js"></script>
  </head>
  <body>
    <script type="module">
      async function doAll() {
        const { ParallelWorkersManager } = PWM;
        const encoder = new TextEncoder();
        const manager = new ParallelWorkersManager(inflate.toString(), {});

        const lines = (
          await fetch('./small.binary').then((response) => response.text())
        )
          .split('\n')
          .filter(Boolean)
          .map((line) => UintBase64.decode(encoder.encode(line)));

        console.time('parse');

        const promises = [];
        for (let line of lines) {
          promises.push(manager.post(line, line.buffer));
        }
        const matrix = await Promise.all(promises);

        console.timeEnd('parse');
      }
      doAll();
    </script>
  </body>
</html>
